<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malla Curricular - Ingeniería en Telecomunicaciones</title>
    <style>
        :root {
            --bg-color: #f5f5f5;
            --text-color: #333;
            --card-bg: #fff;
            --header-bg: #2c3e50;
            --header-text: #fff;
            --course-color: #e1ff00; /* Color único para todos los cursos */
        }

        .dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #f0f0f0;
            --card-bg: #2d2d2d;
            --header-bg: #1a1a1a;
            --header-text: #f0f0f0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
        }

        header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        h1 {
            margin: 0;
            font-size: 1.8rem;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: var(--header-bg);
            color: var(--header-text);
        }

        .toggle-container {
            display: flex;
            align-items: center;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
            margin-left: 10px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(30px);
        }

        .grid-container {
            display: flex;
            flex-direction: column;
            padding: 1rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .year-container {
            margin-bottom: 2rem;
        }

        .year-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--text-color);
        }

        .semester-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
            margin-bottom: 1.5rem;
        }

        .semester-title {
            grid-column: 1 / -1;
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }

        .course-card {
            background-color: var(--course-color);
            border-radius: 5px;
            padding: 0.8rem;
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .course-card:hover {
            transform: translateY(-3px);
            cursor: pointer;
        }

        .course-card.locked {
            opacity: 0.5;
            filter: grayscale(70%);
        }

        .course-card.selected {
            outline: 2px solid #4CAF50;
        }

        .course-name {
            font-weight: bold;
            margin-bottom: 0.3rem;
            font-size: 0.8rem;
            line-height: 1.1;
        }

        .course-code {
            font-size: 0.7rem;
            color: #555;
            margin-bottom: 0.3rem;
        }

        .course-sct {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: rgba(0, 0, 0, 0.1);
            padding: 2px 5px;
            border-radius: 8px;
            font-size: 0.6rem;
            font-weight: bold;
        }

        .stats {
            margin-top: 1rem;
            padding: 1rem;
            background-color: var(--header-bg);
            color: var(--header-text);
            border-radius: 8px;
            text-align: center;
        }

        .stats-item {
            margin: 0.5rem 0;
        }

        @media (max-width: 768px) {
            .semester-container {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Malla Curricular - Ingeniería en Telecomunicaciones</h1>
    </header>

    <div class="controls">
        <div class="toggle-container">
            <span>Modo Oscuro</span>
            <label class="toggle-switch">
                <input type="checkbox" id="darkModeToggle">
                <span class="slider"></span>
            </label>
        </div>
        <div class="stats">
            <div class="stats-item">Total SCT: <span id="totalSCT">0</span></div>
            <div class="stats-item">Cursos seleccionados: <span id="selectedCount">0</span></div>
        </div>
    </div>

    <div class="grid-container" id="gridContainer">
        <!-- Grid content will be added dynamically -->
    </div>

    <script>
        // Data from the provided JSON (abreviado para el ejemplo)
        const mallaData = {
            "data": [
                {
                    "id": 1,
                    "preRequisitos": [],
                    "name": "Algebra Lineal",
                    "code": "MATD113",
                    "area": "Unidad Básica",
                    "directas": 144,
                    "sct": 3,
                    "year": 1,
                    "semestre": 1,
                    "selected": false
                },
                // ... (otros cursos con el mismo formato)
            ],
            "mallaAreas": [
                {
                    "name": "Unidad Básica",
                    "backgroundColor": "#e1ff00"
                }
                // ... (otras áreas)
            ]
        };

        // DOM elements
        const gridContainer = document.getElementById('gridContainer');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const totalSCTElement = document.getElementById('totalSCT');
        const selectedCountElement = document.getElementById('selectedCount');

        // State
        let selectedCourses = new Set();
        let unlockedCourses = new Set();

        // Initialize
        function init() {
            // Group courses by year and semester
            const coursesByYearSemester = groupCourses();

            // Render grid
            renderGrid(coursesByYearSemester);

            // Set up event listeners
            setupEventListeners();

            // Initialize unlocked courses (courses with no prerequisites)
            updateUnlockedCourses();
        }

        // Group courses by year and semester
        function groupCourses() {
            const grouped = {};

            mallaData.data.forEach(course => {
                if (!grouped[course.year]) {
                    grouped[course.year] = {};
                }
                if (!grouped[course.year][course.semestre]) {
                    grouped[course.year][course.semestre] = [];
                }
                grouped[course.year][course.semestre].push(course);
            });

            return grouped;
        }

        // Render grid
        function renderGrid(coursesByYearSemester) {
            // Sort years
            const years = Object.keys(coursesByYearSemester).sort((a, b) => a - b);

            years.forEach(year => {
                const yearContainer = document.createElement('div');
                yearContainer.className = 'year-container';

                const yearTitle = document.createElement('h2');
                yearTitle.className = 'year-title';
                yearTitle.textContent = `Año ${year}`;
                yearContainer.appendChild(yearTitle);

                // Sort semesters
                const semesters = Object.keys(coursesByYearSemester[year]).sort((a, b) => a - b);

                semesters.forEach(semester => {
                    const semesterContainer = document.createElement('div');
                    semesterContainer.className = 'semester-container';

                    const semesterTitle = document.createElement('h3');
                    semesterTitle.className = 'semester-title';
                    semesterTitle.textContent = `Semestre ${semester}`;
                    semesterContainer.appendChild(semesterTitle);

                    // Sort courses by id
                    const courses = coursesByYearSemester[year][semester].sort((a, b) => a.id - b.id);

                    courses.forEach(course => {
                        const courseCard = createCourseCard(course);
                        semesterContainer.appendChild(courseCard);
                    });

                    yearContainer.appendChild(semesterContainer);
                });

                gridContainer.appendChild(yearContainer);
            });
        }

        // Create course card
        function createCourseCard(course) {
            const courseCard = document.createElement('div');
            courseCard.className = 'course-card';
            courseCard.dataset.id = course.id;

            if (course.selected) {
                courseCard.classList.add('selected');
            }

            // Check if course is locked
            const isLocked = !isCourseUnlocked(course);
            if (isLocked) {
                courseCard.classList.add('locked');
            }

            const courseName = document.createElement('div');
            courseName.className = 'course-name';
            courseName.textContent = course.name;

            const courseCode = document.createElement('div');
            courseCode.className = 'course-code';
            courseCode.textContent = course.code;

            const courseSCT = document.createElement('div');
            courseSCT.className = 'course-sct';
            courseSCT.textContent = `SCT: ${course.sct}`;

            courseCard.appendChild(courseName);
            courseCard.appendChild(courseCode);
            courseCard.appendChild(courseSCT);

            return courseCard;
        }

        // Set up event listeners
        function setupEventListeners() {
            // Dark mode toggle
            darkModeToggle.addEventListener('change', function() {
                document.body.classList.toggle('dark-mode', this.checked);
            });

            // Course card clicks
            gridContainer.addEventListener('click', function(e) {
                const courseCard = e.target.closest('.course-card');
                if (!courseCard) return;

                const courseId = parseInt(courseCard.dataset.id);
                const course = mallaData.data.find(c => c.id === courseId);

                // Don't allow selection of locked courses
                if (courseCard.classList.contains('locked')) {
                    return;
                }

                // Toggle selection
                if (course.selected) {
                    course.selected = false;
                    selectedCourses.delete(courseId);
                    courseCard.classList.remove('selected');
                } else {
                    course.selected = true;
                    selectedCourses.add(courseId);
                    courseCard.classList.add('selected');
                }

                // Update unlocked courses based on new selection
                updateUnlockedCourses();

                // Update stats
                updateStats();
            });
        }

        // Check if course is unlocked (all prerequisites are selected)
        function isCourseUnlocked(course) {
            if (course.preRequisitos.length === 0) return true;
            return course.preRequisitos.every(prereqId => selectedCourses.has(prereqId));
        }

        // Update unlocked courses based on current selection
        function updateUnlockedCourses() {
            // Reset all locked states
            document.querySelectorAll('.course-card').forEach(card => {
                card.classList.remove('locked');
            });

            // Update locked state for each course
            mallaData.data.forEach(course => {
                const courseCard = document.querySelector(`.course-card[data-id="${course.id}"]`);
                if (!courseCard) return;

                if (!isCourseUnlocked(course) && !course.selected) {
                    courseCard.classList.add('locked');
                }
            });
        }

        // Update statistics
        function updateStats() {
            let totalSCT = 0;
            selectedCourses.forEach(courseId => {
                const course = mallaData.data.find(c => c.id === courseId);
                if (course) {
                    totalSCT += course.sct;
                }
            });

            totalSCTElement.textContent = totalSCT;
            selectedCountElement.textContent = selectedCourses.size;
        }

        // Initialize the app
        init();
    </script>
</body>
</html>
