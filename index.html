<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malla Curricular - Ingeniería en Telecomunicaciones</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        h1, h2, h3 {
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 5px;
            margin-top: 20px;
        }
        .year-header {
            grid-column: span 1;
            text-align: center;
            font-weight: bold;
            background-color: #ddd;
            padding: 5px;
        }
        .semester-header {
            text-align: center;
            font-weight: bold;
            background-color: #eee;
            padding: 3px;
            font-size: 0.9em;
        }
        .course {
            border: 1px solid #ccc;
            padding: 8px;
            font-size: 0.8em;
            min-height: 80px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
        }
        .course:hover {
            transform: scale(1.03);
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        .course-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .course-code {
            font-size: 0.7em;
            color: #555;
        }
        .course-sct {
            position: absolute;
            bottom: 3px;
            right: 3px;
            font-size: 0.7em;
            font-weight: bold;
        }
        .course-approved {
            background-color: #e6ffe6;
        }
        .course-pending {
            background-color: #f0f0f0;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            width: 60%;
            max-width: 600px;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
        }
        .close {
            float: right;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        button {
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 0.8em;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 5px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Malla Curricular - Ingeniería en Telecomunicaciones</h1>
        <h2>Unidad Básica</h2>
        <h3>Unidad Profesional</h3>
        <h3>Unidad de Integración Curricular</h3>
        
        <div class="controls">
            <button id="toggle-approved">Marcar/Desmarcar como aprobada</button>
            <div>
                <label for="search">Buscar materia:</label>
                <input type="text" id="search" placeholder="Nombre o código">
            </div>
        </div>
        
        <div class="grid" id="curriculum-grid">
            <!-- Grid will be generated by JavaScript -->
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #e1ff00;"></div>
                <span>Unidad Básica</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #0a12ff;"></div>
                <span>Unidad Profesional</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #1dff1a;"></div>
                <span>Unidad de Integración Curricular</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #ff0505;"></div>
                <span>Requisitos Para Graduación</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #ff8d0a;"></div>
                <span>Itinerario Radiocomunicación</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #09b3ec;"></div>
                <span>Itinerario Comunicación</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #f434c1;"></div>
                <span>Itinerario Telemática</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #e6ffe6;"></div>
                <span>Aprobada</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #f0f0f0;"></div>
                <span>Pendiente</span>
            </div>
        </div>
    </div>
    
    <div id="course-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modal-course-name"></h2>
            <p><strong>Código:</strong> <span id="modal-course-code"></span></p>
            <p><strong>Área:</strong> <span id="modal-course-area"></span></p>
            <p><strong>Horas:</strong> <span id="modal-course-hours"></span></p>
            <p><strong>SCT:</strong> <span id="modal-course-sct"></span></p>
            <p><strong>Año:</strong> <span id="modal-course-year"></span>, <strong>Semestre:</strong> <span id="modal-course-semester"></span></p>
            <p><strong>Prerrequisitos:</strong> <span id="modal-course-prerequisites"></span></p>
            <button id="modal-toggle-approved">Marcar como aprobada</button>
        </div>
    </div>

    <script>
        // Curriculum data
        const curriculumData = {
            "data": [
                {
                    "id": 1,
                    "preRequisitos": [],
                    "name": "Algebra Lineal  MATD113",
                    "area": "Unidad Básica",
                    "directas": 144,
                    "sct": 3,
                    "year": 1,
                    "semestre": 1,
                    "selected": false
                },
                // ... (all the other courses from your JSON data)
                // I'm including just one for brevity, but you should include all
            ],
            "mallaAreas": [
                {
                    "name": "Unidad Básica",
                    "backgroundColor": "#e1ff00"
                },
                {
                    "name": "Unidad Profesional",
                    "backgroundColor": "#0a12ff"
                },
                {
                    "name": "Unidad de Integración Curricular",
                    "backgroundColor": "#1dff1a"
                },
                {
                    "name": "Requisitos Para Graduacion",
                    "backgroundColor": "#ff0505"
                },
                {
                    "name": "Itinerario Radiocomunicación",
                    "backgroundColor": "#ff8d0a"
                },
                {
                    "name": "Itinerario Comunicación",
                    "backgroundColor": "#09b3ec"
                },
                {
                    "name": "Itinerario Telemática",
                    "backgroundColor": "#f434c1"
                }
            ]
        };

        // Initialize the curriculum grid
        function initCurriculumGrid() {
            const grid = document.getElementById('curriculum-grid');
            
            // Add year headers
            for (let year = 1; year <= 5; year++) {
                const yearHeader = document.createElement('div');
                yearHeader.className = 'year-header';
                yearHeader.textContent = `Año ${year}`;
                grid.appendChild(yearHeader);
                
                // Add semester headers for each year
                const semesters = year === 5 ? 1 : 2; // Only 1 semester in year 5
                for (let sem = 1; sem <= semesters; sem++) {
                    const semesterHeader = document.createElement('div');
                    semesterHeader.className = 'semester-header';
                    semesterHeader.textContent = `Semestre ${sem}`;
                    grid.appendChild(semesterHeader);
                    
                    // Add courses for this semester
                    const courses = curriculumData.data.filter(c => c.year === year && c.semestre === sem);
                    courses.forEach(course => {
                        const courseDiv = document.createElement('div');
                        courseDiv.className = `course ${course.selected ? 'course-approved' : 'course-pending'}`;
                        courseDiv.dataset.id = course.id;
                        
                        // Find the area color
                        const area = curriculumData.mallaAreas.find(a => a.name === course.area);
                        const bgColor = area ? area.backgroundColor : '#ffffff';
                        
                        courseDiv.style.backgroundColor = bgColor;
                        
                        const nameDiv = document.createElement('div');
                        nameDiv.className = 'course-name';
                        nameDiv.textContent = course.name.split('  ')[0]; // Remove double space before code
                        
                        const codeDiv = document.createElement('div');
                        codeDiv.className = 'course-code';
                        codeDiv.textContent = course.name.split('  ')[1] || ''; // Get the code part
                        
                        const sctDiv = document.createElement('div');
                        sctDiv.className = 'course-sct';
                        sctDiv.textContent = `${course.sct} SCT`;
                        
                        courseDiv.appendChild(nameDiv);
                        courseDiv.appendChild(codeDiv);
                        courseDiv.appendChild(sctDiv);
                        
                        // Add click event
                        courseDiv.addEventListener('click', () => showCourseDetails(course));
                        
                        grid.appendChild(courseDiv);
                    });
                    
                    // Add empty cells if needed
                    const emptyCells = 4 - courses.length;
                    for (let i = 0; i < emptyCells; i++) {
                        const emptyDiv = document.createElement('div');
                        grid.appendChild(emptyDiv);
                    }
                }
            }
        }

        // Show course details in modal
        function showCourseDetails(course) {
            const modal = document.getElementById('course-modal');
            const modalCourseName = document.getElementById('modal-course-name');
            const modalCourseCode = document.getElementById('modal-course-code');
            const modalCourseArea = document.getElementById('modal-course-area');
            const modalCourseHours = document.getElementById('modal-course-hours');
            const modalCourseSct = document.getElementById('modal-course-sct');
            const modalCourseYear = document.getElementById('modal-course-year');
            const modalCourseSemester = document.getElementById('modal-course-semester');
            const modalCoursePrerequisites = document.getElementById('modal-course-prerequisites');
            const modalToggleApproved = document.getElementById('modal-toggle-approved');
            
            modalCourseName.textContent = course.name.split('  ')[0];
            modalCourseCode.textContent = course.name.split('  ')[1] || '';
            modalCourseArea.textContent = course.area;
            modalCourseHours.textContent = `${course.directas} horas`;
            modalCourseSct.textContent = course.sct;
            modalCourseYear.textContent = course.year;
            modalCourseSemester.textContent = course.semestre;
            
            // Get prerequisite names
            const prerequisites = course.preRequisitos.map(id => {
                const prereqCourse = curriculumData.data.find(c => c.id === id);
                return prereqCourse ? prereqCourse.name.split('  ')[0] : '';
            }).filter(name => name !== '');
            
            modalCoursePrerequisites.textContent = prerequisites.length > 0 ? prerequisites.join(', ') : 'Ninguno';
            
            // Set toggle button text
            modalToggleApproved.textContent = course.selected ? 'Marcar como pendiente' : 'Marcar como aprobada';
            modalToggleApproved.onclick = function() {
                toggleCourseApproved(course.id);
                modal.style.display = 'none';
            };
            
            // Show modal
            modal.style.display = 'block';
            
            // Close modal when clicking X
            document.querySelector('.close').onclick = function() {
                modal.style.display = 'none';
            };
            
            // Close modal when clicking outside
            window.onclick = function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            };
        }

        // Toggle course approved status
        function toggleCourseApproved(courseId) {
            const course = curriculumData.data.find(c => c.id === courseId);
            if (course) {
                course.selected = !course.selected;
                
                // Update the grid
                const courseDiv = document.querySelector(`.course[data-id="${courseId}"]`);
                if (courseDiv) {
                    courseDiv.classList.toggle('course-approved', course.selected);
                    courseDiv.classList.toggle('course-pending', !course.selected);
                }
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initCurriculumGrid();
            
            // Toggle approved button
            document.getElementById('toggle-approved').addEventListener('click', function() {
                const selectedCourse = prompt("Ingrese el ID o nombre de la materia:");
                if (selectedCourse) {
                    // Try to find by ID first
                    let course = curriculumData.data.find(c => c.id.toString() === selectedCourse);
                    
                    // If not found by ID, try by name
                    if (!course) {
                        course = curriculumData.data.find(c => 
                            c.name.toLowerCase().includes(selectedCourse.toLowerCase())
                        );
                    }
                    
                    if (course) {
                        toggleCourseApproved(course.id);
                    } else {
                        alert("Materia no encontrada");
                    }
                }
            });
            
            // Search functionality
            document.getElementById('search').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                if (searchTerm.length < 3) return;
                
                const courses = document.querySelectorAll('.course');
                let found = false;
                
                courses.forEach(course => {
                    const courseName = course.querySelector('.course-name').textContent.toLowerCase();
                    const courseCode = course.querySelector('.course-code').textContent.toLowerCase();
                    
                    if (courseName.includes(searchTerm) {
                        course.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        course.style.border = '2px solid red';
                        setTimeout(() => course.style.border = '1px solid #ccc', 2000);
                        found = true;
                    }
                });
                
                if (!found) {
                    alert("No se encontraron materias con ese nombre o código");
                }
            });
        });
    </script>
</body>
</html>
